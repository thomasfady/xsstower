import{_ as L,l as W,g as F,y as G,m as i,r as s,o as P,e as q,b as D,f as a,w as n,F as z,i as d,v as y,j as I,c as K,n as Q,A as g,p as X,a as Y,h as j}from"./index-dce2ea2e.js";import{S as Z}from"./SaveOutline-66609bf3.js";const $=c=>(X("data-v-9549cd55"),c=c(),Y(),c),ee={style:{"justify-content":"space-between"}},ae=$(()=>D("h2",null,"Handler",-1)),te={__name:"Handler",setup(c){const p=W(),N=F(),k=G(),l=i(null),R=i(!1);function x(){fetch("/api/handler/"+l.value.ID+"/members",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:f.value,role:v.value})}).then(()=>{m()})}function m(){fetch("/api/handler/"+k.params.id).then(t=>t.json()).then(t=>{l.value=t})}function w(){fetch("/api/handler/"+l.value.ID,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.value)}).then(t=>t.json()).then(t=>{l.value=t})}function H(t){t.length>2&&fetch("/api/users?search="+t,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{_.value=[],e.forEach(function(r){_.value.push({value:r.Email,label:r.Email})})})}const M=[{title:"Email",key:"User.Email"},{title:"Role",key:"Permission",render(t){return j(g,{options:S,value:t.Permission,onChange:e=>O(t,e)})}},{title:"Action",render(t){return j(y,{type:"error",onClick:()=>A(t)},{default:()=>"Delete"})}}];m();const S=[{value:"READ",label:"Reader"},{value:"WRITE",label:"Writer"},{value:"OWNER",label:"Owner"}],_=i([]),v=i("READ"),f=i("");async function O(t,e){let r=await fetch("/api/handler/"+l.value.ID+"/members",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t.UserID,role:e})});if(r.status==200)t.Permission=e;else{const h=await r.json();p.error(h)}}function A(t){N.error({title:"Delete",content:"Delete the member "+t.User.Email+" ?",positiveText:"Delete",negativeText:"Not Sure",onPositiveClick:()=>{fetch("/api/handler/"+l.value.ID+"/members",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t.UserID})}).then(e=>e.json()).then(e=>{e.length==0?(m(),p.success("Member deleted")):p.error(e)})}})}return(t,e)=>{const r=s("n-icon"),h=s("n-space"),C=s("n-input"),u=s("n-form-item"),U=s("n-switch"),B=s("n-dynamic-input"),E=s("n-form"),b=s("n-card"),T=s("n-tab-pane"),J=s("n-data-table"),V=s("n-tabs");return P(),q(z,null,[D("header",ee,[ae,D("div",null,[a(h,null,{default:n(()=>[a(d(y),{type:"success","icon-placement":"left",onClick:w},{icon:n(()=>[a(r,null,{default:n(()=>[a(d(Z))]),_:1})]),default:n(()=>[I(" Save ")]),_:1})]),_:1})])]),a(V,null,{default:n(()=>[a(T,{name:"Information",tab:"Information"},{default:n(()=>[a(b,null,{default:n(()=>[l.value?(P(),K(E,{key:0},{default:n(()=>[a(u,{path:"domain",label:"Domain"},{default:n(()=>[a(C,{value:l.value.Domain,"onUpdate:value":e[0]||(e[0]=o=>l.value.Domain=o),disabled:""},null,8,["value"])]),_:1}),a(u,{path:"path",label:"Path"},{default:n(()=>[a(C,{value:l.value.Path,"onUpdate:value":e[1]||(e[1]=o=>l.value.Path=o),disabled:""},null,8,["value"])]),_:1}),a(u,{path:"screenshot",label:"Screenshot"},{default:n(()=>[a(U,{value:l.value.Screenshot,"onUpdate:value":e[2]||(e[2]=o=>l.value.Screenshot=o)},null,8,["value"])]),_:1}),a(u,{path:"dom",label:"Dom"},{default:n(()=>[a(U,{value:l.value.Dom,"onUpdate:value":e[3]||(e[3]=o=>l.value.Dom=o)},null,8,["value"])]),_:1}),a(u,{path:"CollectedPages",label:"Collected Page"},{default:n(()=>[a(B,{value:l.value.CollectedPages,"onUpdate:value":e[4]||(e[4]=o=>l.value.CollectedPages=o),placeholder:"Type URL (relative or absolute) or filename (file:///etc/passwd)"},null,8,["value"])]),_:1})]),_:1})):Q("",!0)]),_:1})]),_:1}),a(T,{name:"Members",tab:"Members"},{default:n(()=>[a(b,{title:"Add Member"},{default:n(()=>[a(E,{inline:""},{default:n(()=>[a(u,{label:"User",path:"user_mail"},{default:n(()=>[a(d(g),{value:f.value,"onUpdate:value":e[5]||(e[5]=o=>f.value=o),filterable:"",placeholder:"Search Users",options:_.value,loading:R.value,clearable:"",remote:"",onSearch:H},null,8,["value","options","loading"])]),_:1}),a(u,{label:"Role",path:"user_role"},{default:n(()=>[a(d(g),{options:S,value:v.value,"onUpdate:value":e[6]||(e[6]=o=>v.value=o)},null,8,["value"])]),_:1}),a(u,{label:"",path:"user_role"},{default:n(()=>[a(d(y),{type:"success",secondary:"",onClick:x},{default:n(()=>[I("Create")]),_:1})]),_:1})]),_:1})]),_:1}),a(b,{title:"Member List"},{default:n(()=>[a(J,{columns:M,data:l.value.Members,bordered:!0},null,8,["data"])]),_:1})]),_:1})]),_:1})],64)}}},oe=L(te,[["__scopeId","data-v-9549cd55"]]);export{oe as default};
