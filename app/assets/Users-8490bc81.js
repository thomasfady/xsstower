import{d as S,o as y,e as A,b as C,m as f,l as x,r as l,c as b,w as n,f as e,i as g,g as D,j as k,F as I,_ as T,p as j,a as N,h as P,z as V}from"./index-dce2ea2e.js";import{T as $}from"./TrashOutline-c76d9c2e.js";import{A as z}from"./AddCircleOutline-5f6a83c1.js";import{A as B}from"./AddOutline-6431c29d.js";import{R as M}from"./RefreshOutline-07806ad1.js";const O={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},R=C("g",{fill:"none"},[C("path",{d:"M9.723 2.084a.5.5 0 0 1 .554 0a15.05 15.05 0 0 0 6.294 2.421A.5.5 0 0 1 17 5v4.341a3.015 3.015 0 0 0-1-.94V5.428a15.969 15.969 0 0 1-5.6-2.082l-.4-.249l-.4.249A15.969 15.969 0 0 1 4 5.428V9.5c0 3.392 1.968 5.863 6 7.463V17c0 .342.086.663.237.945l-.057.022a.5.5 0 0 1-.36 0C5.308 16.23 3 13.39 3 9.5V5a.5.5 0 0 1 .43-.495a15.05 15.05 0 0 0 6.293-2.421zM12.5 12v-1a2 2 0 1 1 4 0v1h.5a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-5a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h.5zm1-1v1h2v-1a1 1 0 1 0-2 0zm1.75 4a.75.75 0 1 0-1.5 0a.75.75 0 0 0 1.5 0z",fill:"currentColor"})],-1),J=[R],E=S({name:"ShieldLock20Regular",render:function(_,i){return y(),A("svg",O,J)}}),L={__name:"SetPassword",props:{user:{required:!0}},setup(d,{expose:_}){const i=d,r=f(!1),p=x(),o=f({password:""});function v(){r.value=!0}_({open:v});async function c(){const t=await fetch("/api/admin/users/"+i.user.ID,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o.value)});return t.ok?(p.success("Password changed"),r.value=!1,o.value={password:""}):p.error(await t.json()),!1}return(t,s)=>{const a=l("n-input"),u=l("n-form-item"),w=l("n-form"),U=l("n-modal");return y(),b(U,{show:r.value,"onUpdate:show":s[1]||(s[1]=h=>r.value=h),"mask-closable":!1,preset:"dialog",type:"warning",title:"Change password",content:"Create","positive-text":"Change password","negative-text":"Cancel",onPositiveClick:c},{icon:n(()=>[e(g(E))]),default:n(()=>[e(w,{vertical:""},{default:n(()=>[e(u,{label:"Username"},{default:n(()=>[e(a,{value:i.user.Username,disabled:""},null,8,["value"])]),_:1}),e(u,{label:"New Password",path:"form.password"},{default:n(()=>[e(a,{value:o.value.password,"onUpdate:value":s[0]||(s[0]=h=>o.value.password=h),placeholder:"New Password"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["show"])}}},q={__name:"UsersActions",props:{row:{required:!0}},emits:["UserDeleted"],setup(d,{emit:_}){const i=d,r=D(),p=x(),o=f();function v(){r.error({title:"Delete",content:"Delete the user "+i.row.Username+" ?",positiveText:"Delete",negativeText:"Not Sure",onPositiveClick:()=>{fetch("/api/admin/users/"+i.row.ID,{method:"DELETE"}).then(c=>c.json()).then(c=>{c.length==0?(_("UserDeleted"),p.success("User deleted")):p.error(c)})}})}return(c,t)=>{const s=l("n-icon"),a=l("n-button"),u=l("n-space");return y(),A(I,null,[e(u,{justify:"end",size:"small"},{default:n(()=>[e(a,{type:"warning","icon-placement":"left",onClick:t[0]||(t[0]=w=>o.value.open())},{icon:n(()=>[e(s,null,{default:n(()=>[e(g(E))]),_:1})]),default:n(()=>[k(" Set Password ")]),_:1}),e(a,{type:"error","icon-placement":"left",onClick:v},{icon:n(()=>[e(s,null,{default:n(()=>[e(g($))]),_:1})]),default:n(()=>[k(" Delete ")]),_:1})]),_:1}),e(L,{ref_key:"setPassword",ref:o,user:i.row},null,8,["user"])],64)}}},F={__name:"CreateUser",emits:["userCreated"],setup(d,{expose:_,emit:i}){const r=f(!1),p=x(),o=f({Username:"",Email:"",Password:"",IsAdmin:!1});function v(){r.value=!0}_({open:v});async function c(){const t=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o.value)});return t.ok?(p.success("User created"),r.value=!1,o.value={Username:"",Email:"",Password:"",IsAdmin:!1},i("userCreated")):p.error(await t.json()),!1}return(t,s)=>{const a=l("n-input"),u=l("n-form-item"),w=l("n-switch"),U=l("n-form"),h=l("n-modal");return y(),b(h,{show:r.value,"onUpdate:show":s[4]||(s[4]=m=>r.value=m),"mask-closable":!1,preset:"dialog",title:"Create new user",content:"Create","positive-text":"Confirm","negative-text":"Cancel",onPositiveClick:c},{icon:n(()=>[e(g(z))]),default:n(()=>[e(U,{vertical:""},{default:n(()=>[e(u,{label:"Username",path:"form.Username"},{default:n(()=>[e(a,{value:o.value.Username,"onUpdate:value":s[0]||(s[0]=m=>o.value.Username=m),placeholder:"Username"},null,8,["value"])]),_:1}),e(u,{label:"Password",path:"form.Password"},{default:n(()=>[e(a,{value:o.value.Password,"onUpdate:value":s[1]||(s[1]=m=>o.value.Password=m),placeholder:"Password"},null,8,["value"])]),_:1}),e(u,{label:"Email",path:"form.Email"},{default:n(()=>[e(a,{value:o.value.Email,"onUpdate:value":s[2]||(s[2]=m=>o.value.Email=m),placeholder:"Email"},null,8,["value"])]),_:1}),e(u,{label:"IsAdmin",path:"form.IsAdmin"},{default:n(()=>[e(w,{value:o.value.IsAdmin,"onUpdate:value":s[3]||(s[3]=m=>o.value.IsAdmin=m)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["show"])}}};const G=d=>(j("data-v-008a7dfc"),d=d(),N(),d),H={style:{"justify-content":"space-between"}},K=G(()=>C("h2",null,"Users",-1)),Q=!1,W={__name:"Users",setup(d){const _=x(),i=f();f();function r(){i.value.open()}const p=[{title:"Username",key:"Username"},{title:"Email",key:"Email"},{title:"IsAdmin",key:"IsAdmin",render(t){return P(V,{value:t.IsAdmin,"on-update:value":function(){v(t)}})}},{title:"Action",key:"actions",align:"right",width:300,render(t){return P(q,{row:t,onUserDeleted:o})}}];function o(){fetch("/api/admin/users").then(t=>t.json()).then(t=>{c.value=t})}function v(t){let s={};s.IsAdmin=!t.IsAdmin,fetch("/api/admin/users/"+t.ID,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(a=>a.json()).then(a=>{console.log(a.length),a.length==0?t.IsAdmin=a.IsAdmin:_.error(a)})}const c=f([]);return o(),(t,s)=>{const a=l("n-icon"),u=l("n-button"),w=l("n-space"),U=l("n-data-table"),h=l("n-card");return y(),A(I,null,[C("header",H,[K,C("div",null,[e(w,null,{default:n(()=>[e(u,{type:"success","icon-placement":"left",onClick:s[0]||(s[0]=m=>r())},{icon:n(()=>[e(a,null,{default:n(()=>[e(g(B))]),_:1})]),default:n(()=>[k(" Add ")]),_:1}),e(u,{type:"info","icon-placement":"left",onClick:o},{icon:n(()=>[e(a,null,{default:n(()=>[e(g(M))]),_:1})]),default:n(()=>[k(" Refresh ")]),_:1})]),_:1})])]),e(h,null,{default:n(()=>[e(U,{columns:p,data:c.value,pagination:Q,bordered:!0},null,8,["data"])]),_:1}),e(F,{onUserCreated:o,ref_key:"create",ref:i},null,512)],64)}}},te=T(W,[["__scopeId","data-v-008a7dfc"]]);export{te as default};
